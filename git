#!/home/dafrito/projects/backup-settings/backup

function backup_repo {
	[ -n "$1" ] || die "No repository name given"
	local search="^[^[:space:]]*$1[[:space:]]+"
	local possibles=`all_repos | grep -m 2 -Ece "$search"`
	if [ 0 = $possibles ]; then
		die "No repositories found for '$1'"
	elif [ 2 = $possibles ]; then
		local distincts=`all_repos | grep -m 2 -Ee "$search" | sort -bu -k 1,1 | wc -l`
		if [ $distincts -gt 1 ]; then
			echo "$distincts distinct repositories found for '$1':"
			all_repos | grep -m 2 -o -Ee "$search"
			exit 1
		fi 
	fi
	IFS='
'
	for repo_data in `all_repos | grep -Ee "$search"`; do
		IFS=' 	'
		set -- $repo_data
		local path=$1
		shift
		local targets=$1
		shift
		local args="$*"
		cd `echo $path | sed -e "s%^~%$HOME%"`
		for target in `echo $targets | sed -e 's/,/ /g'`; do 
			push_repo $target $args
		done
	done
}

backup_repo $1

# vim: set filetype=sh :
